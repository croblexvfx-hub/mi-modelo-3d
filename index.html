<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }

    .ui-button {
      position: fixed;
      bottom: 20px;
      width: 60px;
      height: 60px;
      font-size: 30px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.6);
      color: white;
      z-index: 2;
    }

    #prev { left: 20px; }
    #next { right: 20px; }
  </style>
</head>

<body>

<button id="prev" class="ui-button">←</button>
<button id="next" class="ui-button">→</button>

<a-scene
  mindar-image="imageTargetSrc: margot_targets.mind; filterMinCF: 0.0001; filterBeta: 0.003;"
  color-space="sRGB"
  renderer="colorManagement: true, physicallyCorrectLights"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>
  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
  <a-entity id="anchor" mindar-image-target="targetIndex: 0"></a-entity>
</a-scene>

<script>

const models = [
  "./Plato_01.glb",
  "./Plato_02.glb",
  "./Plato_03.glb",
  "./Plato_04.glb",
  "./Plato_05.glb"
];

let currentIndex = 0;
const anchor = document.querySelector("#anchor");
const loadedModels = {};

function createModel(index) {

  const container = document.createElement("a-entity");
  container.setAttribute("position", "0 0 0");
  container.setAttribute("visible", false);

  const model = document.createElement("a-gltf-model");
  model.setAttribute("src", models[index]);

  const yRotation = index * 20; // ← incremento de 20° por modelo

  model.setAttribute("rotation", `90 ${yRotation} 0`);
  model.setAttribute("scale", "4.7 4.7 4.7");

  container.appendChild(model);
  anchor.appendChild(container);

  loadedModels[index] = container;
}

function removeModel(index) {
  if (loadedModels[index]) {
    anchor.removeChild(loadedModels[index]);
    delete loadedModels[index];
  }
}

function updateVisible() {
  Object.keys(loadedModels).forEach(i => {
    loadedModels[i].setAttribute("visible", parseInt(i) === currentIndex);
  });
}

function preloadNeighbors() {

  const prev = (currentIndex - 1 + models.length) % models.length;
  const next = (currentIndex + 1) % models.length;

  [currentIndex, prev, next].forEach(i => {
    if (!loadedModels[i]) createModel(i);
  });

  Object.keys(loadedModels).forEach(i => {
    if (![currentIndex, prev, next].includes(parseInt(i))) {
      removeModel(parseInt(i));
    }
  });

}

function switchModel(newIndex) {
  currentIndex = newIndex;
  preloadNeighbors();
  updateVisible();
}

document.querySelector("#prev").addEventListener("click", () => {
  const newIndex = (currentIndex - 1 + models.length) % models.length;
  switchModel(newIndex);
});

document.querySelector("#next").addEventListener("click", () => {
  const newIndex = (currentIndex + 1) % models.length;
  switchModel(newIndex);
});

createModel(0);
preloadNeighbors();
updateVisible();

</script>

</body>
</html>
